{% extends "list_base.html" %}
{% load i18n staticfiles%}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'datatables/media/css/jquery.dataTables.css' %}">
    <link rel="stylesheet" href="{% static 'messenger/build/css/messenger.css' %}">
    <link rel="stylesheet" href="{% static 'messenger/build/css/messenger-theme-future.css' %}">
{% endblock %}

{% block extra_js %}
    <script src="{% static 'datatables/media/js/jquery.dataTables.js' %}"></script>
    <script src="{% static 'jquery-cookie/jquery.cookie.js' %}"></script>
    <script src="{% static 'messenger/build/js/messenger.min.js' %}"></script>
    <script src="{% static 'messenger/build/js/messenger-theme-future.js' %}"></script>
    <script src="{% static 'lodash/dist/lodash.min.js' %}"></script>
    <script>
    $(document).ready(function(){
       var table = $('#table').DataTable();
       var selected = [];

    $('#table tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
        var id = $(this).data("rowKey");
        var index = $.inArray(id, selected);
        if ( index === -1 ) {
            selected.push( id );
        } else {
            selected.splice( index, 1 );
        }
        console.log(selected);
    } );

    $('#submit').click( function () {
        if (_.isEmpty(selected)){
            Messenger().post({
              message: "{% trans 'Please select review.' %}",
              type: "error",
              showCloseButton:true
            })
            return;
        }

        var csrf_token = $.cookie('csrftoken');
        selected.forEach(function(element,index,array){
            console.log(element);
{#            $.post("{% url 'enterprise.review.commit'%}",{project_id:element, csrfmiddlewaretoken:csrf_token },function(data){#}
{#                console.log(data);#}
{#                Messenger().post({#}
{#                  message: "{% trans 'ApplicationReview committed successfully' %}",#}
{#                  type: "info",#}
{#                  showCloseButton:true#}
{#                })#}
{#            })#}
            $.post("{% url 'enterprise.review.commit'%}",{project_id:element, csrfmiddlewaretoken:csrf_token },function(data){
            Messenger().post({
              message: "{% trans 'Submission committed successfully' %}",
              type: "info",
              showCloseButton:true
            })
        })
        });
    } );
    });
    </script>
{% endblock %}

{% block toolbar %}
<div class="btn-group">
  <a href="{% url "enterprise.project.add" %}" class="btn btn-default">{% trans "Create" %}</a>
  <a href="{% url "login" %}" class="btn btn-default">{% trans "Modify" %}</a>
  <a href="{% url "login" %}" class="btn btn-default">{% trans "Delete" %}</a>
</div>
{% endblock %}

{% block list %}
<table class="display table table-bordered" id="table">
    <thead>
        <th>{% trans "Project" %}</th>
        <th>{% trans "Grade" %}</th>
        <th>{% trans "Location" %}</th>
    </thead>
    {% for p in projects %}
        <tr data-row-key="{{ p.id }}">
            <td>{{ p.project.name|upper }}</td>
            <td>{{ p.grade }}</td>
            <td>{{ p.location }}</td>
        </tr>
    {% endfor %}
</table>

    <a href="#" class="btn btn-primary" id="submit">{% trans "Submit" %}</a>
{% endblock %}
